- name: hsmAPILocksServiceReservationsPOST - Try to reserve all flexible
  request:
    url: "{hsm_base_url}/hsm/v2/locks/service/reservations"
    method: POST
    verify: !bool "{verify}"
    json: {"Type":["Partition"],"ReservationDuration":15,"ProcessingModel":"flexible"}
  response:
    status_code: 200
    verify_response_with:
      - function: tavern.testutils.helpers:validate_pykwalify
        extra_kwargs:
          schema:
            type: map
            required: True
            mapping:
              Success:
                type: seq
                required: True
                sequence:
                  - type: map
                    required: True
                    mapping:
                      ID:
                        type: str
                        required: True
                        enum:
                          - "p9999.9998"
                          - "p9999.9999"
                      DeputyKey:
                        type: str
                        required: True
                      ReservationKey:
                        type: str
                        required: True
                      ExpirationTime:
                        type: str
                        required: False
              Failure:
                type: seq
                required: True
                sequence:
                  - type: map
                    required: True
                    mapping:
                      ID:
                        type: str
                        required: True
                        enum:
                          - "p9999.9996"
                          - "p9999.9997"
                      Reason:
                        type: str
                        required: True
                        enum:
                          - "Locked"
      - function: tavern.testutils.helpers:validate_content
        extra_kwargs:
          comparisons:
            - jmespath: "length(@.Success)"
              operator: "eq"
              expected: 2
            - jmespath: "length(@.Failure)"
              operator: "eq"
              expected: 2
    save:
      json:
        service_key_data_0: Success[0]
        service_key_data_1: Success[1]

