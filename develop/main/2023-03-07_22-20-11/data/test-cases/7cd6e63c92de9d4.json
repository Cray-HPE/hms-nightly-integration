{"uid":"7cd6e63c92de9d4","name":"capmcAPISetPowerCap","fullName":"api.4-build-pipeline-only.test_set_power_cap.tavern#capmcAPISetPowerCap","historyId":"dd408b17f7b8e55258fcff9f663cd89b","time":{"start":1678227166171,"stop":1678227166365,"duration":194},"status":"failed","statusMessage":"tavern.util.exceptions.TestFailError: Test 'capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes' failed:\n- Error calling validate function '<function validate_pykwalify at 0x7f3106652d30>':\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 106, in verify_generic\n        verifier.validate()\n      File \"/usr/lib/python3.9/site-packages/pykwalify/core.py\", line 194, in validate\n        raise SchemaError(u\"Schema validation failed:\\n - {error_msg}.\".format(\n    pykwalify.errors.SchemaError: <SchemaError: error code 2: Schema validation failed:\n     - Enum '22' does not exist. Path: '/e' Enum: [0].\n     - Value '[{'nid': 20, 'e': 22, 'err_msg': 'No NID supported controls specified'}, {'nid': 1027, 'e': 22, 'err_msg': 'Control (Node Power Limit) value (5036) is greater than maximum (925)'}]' is not of type 'none'. Path: '/nids'.: Path: '/'>\n\n    The above exception was the direct cause of the following exception:\n\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/tavern/response/base.py\", line 152, in _maybe_run_validate_functions\n        vf(response)\n      File \"/usr/lib/python3.9/site-packages/tavern/util/extfunctions.py\", line 98, in inner\n        result = func(response, *args, **kwargs)\n      File \"/usr/lib/python3.9/site-packages/tavern/testutils/helpers.py\", line 103, in validate_pykwalify\n        verify_generic(to_verify, schema)\n      File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 109, in verify_generic\n        raise BadSchemaError() from e\n    tavern.util.exceptions.BadSchemaError","statusTrace":"Format variables:\n  capmc_base_url = 'http://cray-capmc:27777'\n  nid0:d = '20'\n  min0:d = '5036'\n  nid1:d = '1027'\n  min1:d = '5036'\n  verify = 'False'\n\nSource test stage (line 184):\n  - name: capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes\n    request:\n      url: \"{capmc_base_url}/capmc/v1/set_power_cap\"\n      json:\n        nids:\n          - nid: !int \"{nid0:d}\"\n            controls:\n              - name: Node Power Limit\n                val: !int \"{min0:d}\"\n          - nid: !int \"{nid1:d}\"\n            controls:\n              - name: Node Power Limit\n                val: !int \"{min1:d}\"\n      method: POST\n      verify: !bool \"{verify}\"\n    response:\n      status_code: 200\n      verify_response_with:\n        function: tavern.testutils.helpers:validate_pykwalify\n        extra_kwargs:\n\n\n\n\n\n\n          schema:\n            type: map\n            mapping:\n              e:\n                type: int\n                required: True\n                enum:\n                  - 0\n              err_msg:\n                type: str\n                required: True\n              nids:\n                type: none\n                required: False\n\n\nFormatted stage:\n  name: capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes\n  request:\n    json:\n      nids:\n      - controls:\n        - name: Node Power Limit\n          val: !int '5036'\n        nid: !int '20'\n      - controls:\n        - name: Node Power Limit\n          val: !int '5036'\n        nid: !int '1027'\n    method: POST\n    url: 'http://cray-capmc:27777/capmc/v1/set_power_cap'\n    verify: !bool 'False'\n  response:\n    status_code: 200\n    verify_response_with:\n      extra_kwargs:\n        schema:\n          mapping:\n            e:\n              enum:\n              - 0\n              required: true\n              type: int\n            err_msg:\n              required: true\n              type: str\n            nids:\n              required: false\n              type: none\n          type: map\n      function: tavern.testutils.helpers:validate_pykwalify\n\nErrors:\nE   tavern.util.exceptions.TestFailError: Test 'capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes' failed:\n    - Error calling validate function '<function validate_pykwalify at 0x7f3106652d30>':\n        Traceback (most recent call last):\n          File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 106, in verify_generic\n            verifier.validate()\n          File \"/usr/lib/python3.9/site-packages/pykwalify/core.py\", line 194, in validate\n            raise SchemaError(u\"Schema validation failed:\\n - {error_msg}.\".format(\n        pykwalify.errors.SchemaError: <SchemaError: error code 2: Schema validation failed:\n         - Enum '22' does not exist. Path: '/e' Enum: [0].\n         - Value '[{'nid': 20, 'e': 22, 'err_msg': 'No NID supported controls specified'}, {'nid': 1027, 'e': 22, 'err_msg': 'Control (Node Power Limit) value (5036) is greater than maximum (925)'}]' is not of type 'none'. Path: '/nids'.: Path: '/'>\n    \n        The above exception was the direct cause of the following exception:\n    \n        Traceback (most recent call last):\n          File \"/usr/lib/python3.9/site-packages/tavern/response/base.py\", line 152, in _maybe_run_validate_functions\n            vf(response)\n          File \"/usr/lib/python3.9/site-packages/tavern/util/extfunctions.py\", line 98, in inner\n            result = func(response, *args, **kwargs)\n          File \"/usr/lib/python3.9/site-packages/tavern/testutils/helpers.py\", line 103, in validate_pykwalify\n            verify_generic(to_verify, schema)\n          File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 109, in verify_generic\n            raise BadSchemaError() from e\n        tavern.util.exceptions.BadSchemaError","flaky":true,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"testStage":{"status":"failed","statusMessage":"tavern.util.exceptions.TestFailError: Test 'capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes' failed:\n- Error calling validate function '<function validate_pykwalify at 0x7f3106652d30>':\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 106, in verify_generic\n        verifier.validate()\n      File \"/usr/lib/python3.9/site-packages/pykwalify/core.py\", line 194, in validate\n        raise SchemaError(u\"Schema validation failed:\\n - {error_msg}.\".format(\n    pykwalify.errors.SchemaError: <SchemaError: error code 2: Schema validation failed:\n     - Enum '22' does not exist. Path: '/e' Enum: [0].\n     - Value '[{'nid': 20, 'e': 22, 'err_msg': 'No NID supported controls specified'}, {'nid': 1027, 'e': 22, 'err_msg': 'Control (Node Power Limit) value (5036) is greater than maximum (925)'}]' is not of type 'none'. Path: '/nids'.: Path: '/'>\n\n    The above exception was the direct cause of the following exception:\n\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/tavern/response/base.py\", line 152, in _maybe_run_validate_functions\n        vf(response)\n      File \"/usr/lib/python3.9/site-packages/tavern/util/extfunctions.py\", line 98, in inner\n        result = func(response, *args, **kwargs)\n      File \"/usr/lib/python3.9/site-packages/tavern/testutils/helpers.py\", line 103, in validate_pykwalify\n        verify_generic(to_verify, schema)\n      File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 109, in verify_generic\n        raise BadSchemaError() from e\n    tavern.util.exceptions.BadSchemaError","statusTrace":"Format variables:\n  capmc_base_url = 'http://cray-capmc:27777'\n  nid0:d = '20'\n  min0:d = '5036'\n  nid1:d = '1027'\n  min1:d = '5036'\n  verify = 'False'\n\nSource test stage (line 184):\n  - name: capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes\n    request:\n      url: \"{capmc_base_url}/capmc/v1/set_power_cap\"\n      json:\n        nids:\n          - nid: !int \"{nid0:d}\"\n            controls:\n              - name: Node Power Limit\n                val: !int \"{min0:d}\"\n          - nid: !int \"{nid1:d}\"\n            controls:\n              - name: Node Power Limit\n                val: !int \"{min1:d}\"\n      method: POST\n      verify: !bool \"{verify}\"\n    response:\n      status_code: 200\n      verify_response_with:\n        function: tavern.testutils.helpers:validate_pykwalify\n        extra_kwargs:\n\n\n\n\n\n\n          schema:\n            type: map\n            mapping:\n              e:\n                type: int\n                required: True\n                enum:\n                  - 0\n              err_msg:\n                type: str\n                required: True\n              nids:\n                type: none\n                required: False\n\n\nFormatted stage:\n  name: capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes\n  request:\n    json:\n      nids:\n      - controls:\n        - name: Node Power Limit\n          val: !int '5036'\n        nid: !int '20'\n      - controls:\n        - name: Node Power Limit\n          val: !int '5036'\n        nid: !int '1027'\n    method: POST\n    url: 'http://cray-capmc:27777/capmc/v1/set_power_cap'\n    verify: !bool 'False'\n  response:\n    status_code: 200\n    verify_response_with:\n      extra_kwargs:\n        schema:\n          mapping:\n            e:\n              enum:\n              - 0\n              required: true\n              type: int\n            err_msg:\n              required: true\n              type: str\n            nids:\n              required: false\n              type: none\n          type: map\n      function: tavern.testutils.helpers:validate_pykwalify\n\nErrors:\nE   tavern.util.exceptions.TestFailError: Test 'capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes' failed:\n    - Error calling validate function '<function validate_pykwalify at 0x7f3106652d30>':\n        Traceback (most recent call last):\n          File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 106, in verify_generic\n            verifier.validate()\n          File \"/usr/lib/python3.9/site-packages/pykwalify/core.py\", line 194, in validate\n            raise SchemaError(u\"Schema validation failed:\\n - {error_msg}.\".format(\n        pykwalify.errors.SchemaError: <SchemaError: error code 2: Schema validation failed:\n         - Enum '22' does not exist. Path: '/e' Enum: [0].\n         - Value '[{'nid': 20, 'e': 22, 'err_msg': 'No NID supported controls specified'}, {'nid': 1027, 'e': 22, 'err_msg': 'Control (Node Power Limit) value (5036) is greater than maximum (925)'}]' is not of type 'none'. Path: '/nids'.: Path: '/'>\n    \n        The above exception was the direct cause of the following exception:\n    \n        Traceback (most recent call last):\n          File \"/usr/lib/python3.9/site-packages/tavern/response/base.py\", line 152, in _maybe_run_validate_functions\n            vf(response)\n          File \"/usr/lib/python3.9/site-packages/tavern/util/extfunctions.py\", line 98, in inner\n            result = func(response, *args, **kwargs)\n          File \"/usr/lib/python3.9/site-packages/tavern/testutils/helpers.py\", line 103, in validate_pykwalify\n            verify_generic(to_verify, schema)\n          File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 109, in verify_generic\n            raise BadSchemaError() from e\n        tavern.util.exceptions.BadSchemaError","steps":[{"name":"Stage 0: capmcAPISetPowerCap - setup1 - Get HSM Nodes","time":{"start":1678227166183,"stop":1678227166220,"duration":37},"status":"passed","steps":[],"attachments":[{"uid":"724b0694a57cb47","name":"stage_yaml","source":"724b0694a57cb47.yaml","type":"application/yaml","size":457},{"uid":"e894c528f43bbfc9","name":"rest_request","source":"e894c528f43bbfc9.yaml","type":"application/yaml","size":149},{"uid":"1e045507ee05d88e","name":"rest_response","source":"1e045507ee05d88e.yaml","type":"application/yaml","size":5770}],"parameters":[],"stepsCount":0,"attachmentsCount":3,"shouldDisplayMessage":false,"hasContent":true},{"name":"Stage 1: capmcAPISetPowerCap - setup2 - get_power_cap_capabilities","time":{"start":1678227166221,"stop":1678227166276,"duration":55},"status":"passed","steps":[],"attachments":[{"uid":"a404270fa2315655","name":"stage_yaml","source":"a404270fa2315655.yaml","type":"application/yaml","size":472},{"uid":"796bef5a215eab24","name":"rest_request","source":"796bef5a215eab24.yaml","type":"application/yaml","size":171},{"uid":"36ce7c3747c91322","name":"rest_response","source":"36ce7c3747c91322.yaml","type":"application/yaml","size":980}],"parameters":[],"stepsCount":0,"attachmentsCount":3,"shouldDisplayMessage":false,"hasContent":true},{"name":"Stage 2: capmcAPISetPowerCap - setup3 - Set HSM Node 0 to Off","time":{"start":1678227166277,"stop":1678227166288,"duration":11},"status":"passed","steps":[],"attachments":[{"uid":"683b0c7dcb176ba1","name":"stage_yaml","source":"683b0c7dcb176ba1.yaml","type":"application/yaml","size":247},{"uid":"9324c8e2b8caa731","name":"rest_request","source":"9324c8e2b8caa731.yaml","type":"application/yaml","size":173},{"uid":"5b40b7d257fc420a","name":"rest_response","source":"5b40b7d257fc420a.yaml","type":"application/yaml","size":134}],"parameters":[],"stepsCount":0,"attachmentsCount":3,"shouldDisplayMessage":false,"hasContent":true},{"name":"Stage 3: capmcAPISetPowerCap - setup4 - Set HSM Node 1 to Off","time":{"start":1678227166289,"stop":1678227166298,"duration":9},"status":"passed","steps":[],"attachments":[{"uid":"fb4a3a9c5139efa9","name":"stage_yaml","source":"fb4a3a9c5139efa9.yaml","type":"application/yaml","size":247},{"uid":"4a2a9b23c331a9da","name":"rest_request","source":"4a2a9b23c331a9da.yaml","type":"application/yaml","size":173},{"uid":"5962186a2801edc2","name":"rest_response","source":"5962186a2801edc2.yaml","type":"application/yaml","size":134}],"parameters":[],"stepsCount":0,"attachmentsCount":3,"shouldDisplayMessage":false,"hasContent":true},{"name":"Stage 4: capmcAPISetPowerCap - test1 - POST set_power_cap for powered off node - failure test","time":{"start":1678227166299,"stop":1678227166321,"duration":22},"status":"passed","steps":[],"attachments":[{"uid":"6fb0dbca867347cc","name":"stage_yaml","source":"6fb0dbca867347cc.yaml","type":"application/yaml","size":1395},{"uid":"80642d16c809a5d7","name":"rest_request","source":"80642d16c809a5d7.yaml","type":"application/yaml","size":212},{"uid":"11c5c7fd51a4c432","name":"rest_response","source":"11c5c7fd51a4c432.yaml","type":"application/yaml","size":285}],"parameters":[],"stepsCount":0,"attachmentsCount":3,"shouldDisplayMessage":false,"hasContent":true},{"name":"Stage 5: capmcAPISetPowerCap - setup5 - Set HSM Node 0 to Ready","time":{"start":1678227166322,"stop":1678227166331,"duration":9},"status":"passed","steps":[],"attachments":[{"uid":"b57833547893a71c","name":"stage_yaml","source":"b57833547893a71c.yaml","type":"application/yaml","size":251},{"uid":"7d01ee416a84b569","name":"rest_request","source":"7d01ee416a84b569.yaml","type":"application/yaml","size":173},{"uid":"2446aa8a579fbf39","name":"rest_response","source":"2446aa8a579fbf39.yaml","type":"application/yaml","size":134}],"parameters":[],"stepsCount":0,"attachmentsCount":3,"shouldDisplayMessage":false,"hasContent":true},{"name":"Stage 6: capmcAPISetPowerCap - setup6 - Set HSM Node 1 to Ready","time":{"start":1678227166332,"stop":1678227166342,"duration":10},"status":"passed","steps":[],"attachments":[{"uid":"adc7b26989cd2722","name":"stage_yaml","source":"adc7b26989cd2722.yaml","type":"application/yaml","size":251},{"uid":"5222fb50cc81c314","name":"rest_request","source":"5222fb50cc81c314.yaml","type":"application/yaml","size":173},{"uid":"1a90738cd4484f3","name":"rest_response","source":"1a90738cd4484f3.yaml","type":"application/yaml","size":134}],"parameters":[],"stepsCount":0,"attachmentsCount":3,"shouldDisplayMessage":false,"hasContent":true},{"name":"Stage 7: capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes","time":{"start":1678227166342,"stop":1678227166363,"duration":21},"status":"failed","statusMessage":"tavern.util.exceptions.TestFailError: Test 'capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes' failed:\n- Error calling validate function '<function validate_pykwalify at 0x7f3106652d30>':\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 106, in verify_generic\n        verifier.validate()\n      File \"/usr/lib/python3.9/site-packages/pykwalify/core.py\", line 194, in validate\n        raise SchemaError(u\"Schema validation failed:\\n - {error_msg}.\".format(\n    pykwalify.errors.SchemaError: <SchemaError: error code 2: Schema validation failed:\n     - Enum '22' does not exist. Path: '/e' Enum: [0].\n     - Value '[{'nid': 20, 'e': 22, 'err_msg': 'No NID supported controls specified'}, {'nid': 1027, 'e': 22, 'err_msg': 'Control (Node Power Limit) value (5036) is greater than maximum (925)'}]' is not of type 'none'. Path: '/nids'.: Path: '/'>\n\n    The above exception was the direct cause of the following exception:\n\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/tavern/response/base.py\", line 152, in _maybe_run_validate_functions\n        vf(response)\n      File \"/usr/lib/python3.9/site-packages/tavern/util/extfunctions.py\", line 98, in inner\n        result = func(response, *args, **kwargs)\n      File \"/usr/lib/python3.9/site-packages/tavern/testutils/helpers.py\", line 103, in validate_pykwalify\n        verify_generic(to_verify, schema)\n      File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 109, in verify_generic\n        raise BadSchemaError() from e\n    tavern.util.exceptions.BadSchemaError\n\n","statusTrace":"  File \"/usr/lib/python3.9/site-packages/allure_commons/_allure.py\", line 192, in impl\n    return func(*a, **kw)\n  File \"/usr/lib/python3.9/site-packages/tavern/util/retry.py\", line 31, in wrapped\n    res = fn(*args, **kwargs)\n  File \"/usr/lib/python3.9/site-packages/tavern/core.py\", line 270, in run_stage\n    saved = v.verify(response)\n  File \"/usr/lib/python3.9/site-packages/tavern/_plugins/rest/response.py\", line 201, in verify\n    raise exceptions.TestFailError(\n","steps":[],"attachments":[{"uid":"b35dd7e858dfbf5c","name":"stage_yaml","source":"b35dd7e858dfbf5c.yaml","type":"application/yaml","size":903},{"uid":"451d9ae9919317f1","name":"rest_request","source":"451d9ae9919317f1.yaml","type":"application/yaml","size":286},{"uid":"2b836790b5a2f713","name":"rest_response","source":"2b836790b5a2f713.yaml","type":"application/yaml","size":394}],"parameters":[],"stepsCount":0,"attachmentsCount":3,"shouldDisplayMessage":true,"hasContent":true}],"attachments":[{"uid":"ab68136b51a691c9","name":"error_output","source":"ab68136b51a691c9.attach","type":"text/plain","size":3773},{"uid":"2619fa37b5c6d1a9","name":"log","source":"2619fa37b5c6d1a9.txt","type":"text/plain","size":4427}],"parameters":[],"stepsCount":8,"attachmentsCount":26,"shouldDisplayMessage":true,"hasContent":true},"afterStages":[],"labels":[{"name":"parentSuite","value":"cray-capmc-hmth-test"},{"name":"suite","value":"build-pipeline-only"},{"name":"host","value":"8c698c5f12ca"},{"name":"thread","value":"8-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"api.4-build-pipeline-only.test_set_power_cap.tavern"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":2,"broken":0,"skipped":0,"passed":10,"unknown":0,"total":12},"items":[{"uid":"a6af399a285b3715","status":"passed","time":{"start":1678225287563,"stop":1678225288062,"duration":499}},{"uid":"a73e3b38d4ac4038","status":"passed","time":{"start":1678222372040,"stop":1678222372351,"duration":311}},{"uid":"85abc9a55ca6ef16","status":"passed","time":{"start":1678218699413,"stop":1678218699721,"duration":308}},{"uid":"1842d17941e1070a","status":"passed","time":{"start":1674515668181,"stop":1674515668515,"duration":334}},{"uid":"22e78f499c7e01f7","status":"failed","statusDetails":"tavern.util.exceptions.TestFailError: Test 'capmcAPISetPowerCap - test2 - set_power_cap for two ready nodes' failed:\n- Error calling validate function '<function validate_pykwalify at 0x7fc6d17dad30>':\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 106, in verify_generic\n        verifier.validate()\n      File \"/usr/lib/python3.9/site-packages/pykwalify/core.py\", line 194, in validate\n        raise SchemaError(u\"Schema validation failed:\\n - {error_msg}.\".format(\n    pykwalify.errors.SchemaError: <SchemaError: error code 2: Schema validation failed:\n     - Enum '22' does not exist. Path: '/e' Enum: [0].\n     - Value '[{'nid': 1001, 'e': 22, 'err_msg': 'Control (Node Power Limit) value (5036) is greater than maximum (925)'}, {'nid': 20, 'e': 22, 'err_msg': 'No NID supported controls specified'}]' is not of type 'none'. Path: '/nids'.: Path: '/'>\n\n    The above exception was the direct cause of the following exception:\n\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/tavern/response/base.py\", line 152, in _maybe_run_validate_functions\n        vf(response)\n      File \"/usr/lib/python3.9/site-packages/tavern/util/extfunctions.py\", line 98, in inner\n        result = func(response, *args, **kwargs)\n      File \"/usr/lib/python3.9/site-packages/tavern/testutils/helpers.py\", line 103, in validate_pykwalify\n        verify_generic(to_verify, schema)\n      File \"/usr/lib/python3.9/site-packages/tavern/schemas/files.py\", line 109, in verify_generic\n        raise BadSchemaError() from e\n    tavern.util.exceptions.BadSchemaError","time":{"start":1674505831201,"stop":1674505831457,"duration":256}},{"uid":"40511fa35e2303dc","status":"passed","time":{"start":1674500620671,"stop":1674500621024,"duration":353}},{"uid":"cf66001f458ab575","status":"passed","time":{"start":1674258027431,"stop":1674258027774,"duration":343}},{"uid":"e346f5a249383d1","status":"passed","time":{"start":1674255379914,"stop":1674255380264,"duration":350}},{"uid":"b35bb70cce03f06e","status":"passed","time":{"start":1674080392244,"stop":1674080392612,"duration":368}},{"uid":"29d894711216bae8","status":"passed","time":{"start":1674075104227,"stop":1674075104612,"duration":385}},{"uid":"6017af36c03a18df","status":"passed","time":{"start":1674074718740,"stop":1674074719093,"duration":353}}]},"tags":[]},"source":"7cd6e63c92de9d4.json","parameterValues":[]}