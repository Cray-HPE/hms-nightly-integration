- name: Phone home back to cloud-init with POST to /phone-home
  request:
    url: "{bss_base_url}/phone-home"
    method: POST
    verify: !bool "{verify}"
    json:
      pub_key_dsa: "pub_key_dsa_value"
      pub_key_rsa: "pub_key_rsa_value"
      pub_key_ecdsa: "pub_key_ecdsa_value"
      pub_key_ed25519: "pub_key_ed25519_value"
      instance_id: "instance_id_value"
      hostname: "hostname_value"
      fqdn: "fqdn_value"

  response:
    status_code: 200
    verify_response_with:
      function: tavern.testutils.helpers:validate_pykwalify
      extra_kwargs:
        schema:
          type: map
          mapping:
            hosts:
              type: seq
              sequence:
              - type: str
                enum:
                - x9999c0s1b0n0
            macs:
              type: seq
              range:
                max: 0
              sequence:
              - type: str
            nids:
              type: seq
              range:
                max: 0
              sequence:
              - type: int
            params:
              type: str
              enum:
              - console=tty0
            kernel:
              type: str
              enum:
              - s3://boot-images/00000000-0000-0000-0000-000000000000/kernel
            initrd:
              type: str
              enum:
              - s3://boot-images/00000000-0000-0000-0000-000000000000/initrd
            cloud-init:
              type: map
              allowempty: true
              mapping:
                meta-data:
                  type: map
                  mapping:
                    meta-data-key:
                      type: str
                      enum:
                      - foo
                    nested-data:
                      type: map
                      mapping:
                        foo:
                          type: str
                          enum:
                          - bar
                user-data:
                  type: map
                  mapping:
                    user-data-key:
                      type: str
                      enum:
                      - bar
                phone-home:
                  type: map
                  mapping:
                    pub_key_dsa:
                      type: str
                      enum:
                      - "pub_key_dsa_value"
                    pub_key_rsa:
                      type: str
                      enum:
                      - "pub_key_rsa_value"
                    pub_key_ecdsa:
                      type: str
                      enum:
                      - "pub_key_ecdsa_value"
                    pub_key_ed25519:
                      type: str
                      enum:
                      - "pub_key_ed25519_value"
                    instance_id:
                      type: str
                      enum:
                      - "instance_id_value"
                    hostname:
                      type: str
                      enum:
                      - "hostname_value"
                    fqdn:
                      type: str
                      enum:
                      - "fqdn_value"
